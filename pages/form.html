<div id="background"></div>
<div id="pageTeste">

    <div id="conteudo">
        <h1 id="title">Cápsula do Tempo</h1>

        <div id="carta">
            <form id="formCarta">
                <label for="nome">Nome:</label>
                <input type="text" name="nome" id="nome" placeholder="Digite seu nome" class="form-control">

                <label for="email">E-mail:</label>
                <input type="email" name="email" id="email" placeholder="Digite seu e-mail" class="form-control">

                <label for="curso">Curso:</label>
                <select name="curso" id="curso" class="form-select">
                    <option value="" disabled selected>Selecione seu curso</option>
                    <option value="curso1">Curso 1</option>
                    <option value="curso2">Curso 2</option>
                </select>

                <label for="disciplina">Disciplina:</label>
                <select name="disciplina" id="disciplina" class="form-select">
                    <option value="" disabled selected>Selecione a disciplina</option>
                    <option value="disciplina1">Disciplina 1</option>
                    <option value="disciplina2">Disciplina 2</option>
                </select>

                <label for="carta">Carta:</label>
                <textarea class="form-control" id="carta" name="carta"></textarea>
            </form>
            
            <button id="btnEnviarCarta" class="btn">Enviar Carta</button>
        </div>
    </div>
</div>

<!-- Operações -->
<script>
    $("#btnEnviarCarta").on('click', function(e){
        e.preventDefault();

        let vazios = false;

        // $('select.selectResposta').each(function() {
        $('input, textarea').each(function() {
            if ($(this).val() === "" || $(this).val() == null) {
                $(this).css('border', '1px solid red');
                vazios = true;
            }else{
                $(this).css('border', 'var(--bs-border-width) solid var(--bs-border-color)');
            }
        });

        if(vazios) {
            $(this).css('border', 'var(--bs-border-width) solid var(--bs-border-color)');
            
            Swal.fire(
                'Ops...',
                'Preencha todos os campos',
                'warning'
            );
        }else{ 

            let data = {};
            let array = $("#formCarta").serializeArray();

            array.forEach((item) => {
                data[item.name] = item.value;
            });

            const formData = new FormData();
            formData.set('entry.1441168353', data.nome); 
            formData.set('entry.235062205', data.email); 
            formData.set('entry.1178915774', data.curso); 
            formData.set('entry.74494594', data.disciplina); 
            formData.set('entry.1669462136', data.carta); 

            let dataHoje = new Date();
            let dia = dataHoje.getDate();
            let mes = dataHoje.getMonth() + 1;
            let ano = dataHoje.getFullYear();

            formData.set('entry.906898823_day', dia);
            formData.set('entry.906898823_month', mes);
            formData.set('entry.906898823_year', ano);

            const url = 'https://docs.google.com/forms/d/e/1FAIpQLSfBst1hODEZbXpC4ptHOKZX_-EbkUy4VP7_nZbkJDV-wKfQgQ/formResponse';
            fetch(url, {
                method: 'POST',
                mode: 'no-cors',
                body: formData
            })
            .then(response => {
                Swal.fire({
                    title: 'Uhul!',
                    text: 'Carta enviada com sucesso',
                    icon: 'success',
                    confirmButtonText: 'Eba!'
                }).then(function(){
                    window.location.reload();
                });
            })
            .catch(error => {
                Swal.fire({
                    title: 'Ops...',
                    text: 'Houve um erro ao processar sua carta',
                    icon: 'error',
                    confirmButtonText: 'Tenter novamente'
                }).then(function(){
                    window.location.reload();
                })
            });
        }
    });
</script>